<!-- This code is a modification of this page => https://alexanderameye.github.io/ -->
<!DOCTYPE html>
<html lang="en">
    <!-- HEAD -->
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<meta name="description" content="How to create a stylized water shader in Unity.">
<meta name="author" content="Xavier Arpa">

<!-- Tells Google not to provide a translation for this document -->
<meta name="google" content="notranslate">

<!-- Identify the software used to build the document -->
<meta name="generator" content="eleventy">

<!-- Open graph -->
<meta property="og:title" content="Creating a Stylized Water Shader">
<meta property="og:description" content="How to create a stylized water shader in Unity.">
<meta property="og:type" content="article">
<meta property="og:image" content="undefined/notes/stylized-water-shader/cover.png"/>
<meta property="og:image:width" content="1200"/>
<meta property="og:image:height" content="675"/>

<!-- Twitter -->
<meta name="twitter:title" content="Creating a Stylized Water Shader">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@_kingdox_">
<meta name="twitter:description" content="How to create a stylized water shader in Unity.">
<meta name="twitter:image" content="https://kingdox.github.io/notes/stylized-water-shader/cover.png">
<meta name="twitter:creator" content="@_kingdox_">

<title>Creating a Stylized Water Shader</title>

<!-- CSS -->
<link rel="preload" href="/assets/css/reset.css" as="style" onload="this.onload=null;this.rel='stylesheet'">


<noscript><link rel="stylesheet" href="/assets/css/reset.css"></noscript>



<style>:root{--image-border-radius:2px;--base-color:#fdfdfd;--accent-color:#ffd8b5;--scrollbar-color:rgba(0, 0, 0, 0.15);--content-size:800px;--link-hover-color:rgb(0, 0, 0);--highlighter-roundness:10px;--marker-roundness:10px;--green:130,255,173;--orange:255,218,98;--blue:79,155,255;--red:255,98,124;--yellow:255,234,71;--gray:rgba(60, 60, 60, 0.7)}body,html{background-color:var(--base-color);margin:0;padding:0;scroll-behavior:smooth;border:none}::selection{background-color:#e0e0e0}.fade-in{animation:fade-in 1s cubic-bezier(.165,.84,.44,1) both}@keyframes fade-in{0%{opacity:0}100%{opacity:1}}.note-content h1{text-align:center;margin-top:20px;margin-bottom:15px}.column-page-content h2{margin-top:40px;margin-bottom:15px}.note-content h3{margin-top:40px;margin-bottom:15px}.note-content h4{margin-top:40px;margin-bottom:5px;font-size:15px}p{-webkit-hyphens:auto;-ms-hyphens:auto;-moz-hyphens:auto;hyphens:auto}.column-page-content p{margin-bottom:10px;padding:0;font-family:Inconsolata,monospace;text-align:justify;font-style:normal;font-size:16px;letter-spacing:.02em;line-height:1.6em;overflow-wrap:break-word}.column-page-content p a{text-decoration:none;border-bottom:2px dotted #000;opacity:1;color:#000}.column-page-content p a:hover{background-color:var(--link-hover-color);color:#fff;transition:color .2s ease;font-weight:700;opacity:1}.note-content{background-color:var(--base-color)}.column-page-content{grid-area:content;position:relative}.note-title{line-height:1.3em}.note-subtitle{text-align:center;font-size:medium}.note-subtitle p{text-align:center}.reading-time{font-family:Inconsolata,monospace;font-weight:400}.katex-display .katex{padding-top:10px;padding-bottom:10px;border:2px dashed #cacaca;border-radius:5px}.katex-display>.katex{white-space:nowrap;text-align:initial}.katex{line-height:1.2;white-space:normal;text-indent:0}blockquote{box-sizing:border-box;font-style:italic;color:#494949;background-color:rgba(230,230,230,.5);border-color:#000;border-radius:4px;border-width:2px;border-style:solid;margin-top:15px;margin-bottom:15px;padding:8px 16px}.column-page-content blockquote p{margin:0;text-align:left}.column-page-content blockquote:hover{outline-offset:0;animation:pulse 1s ease-out infinite forwards;z-index:1000}@keyframes pulse{0%{outline-offset:0;outline:solid 4px rgba(160,160,160,.5)}100%{outline-offset:8px;outline:solid 2px rgb(255,255,255,0)}}.note-date{margin-top:50px;padding-bottom:0;margin-bottom:0;font-size:smaller;font-family:arial-rounded-bold}.note-footer{grid-area:footer;background-color:var(--base-color);border-top:2px dashed var(--gray);margin-top:20px;padding-top:.8rem;display:flex;align-items:center;justify-content:space-between}.note-tags{padding:0}.note-tags a{display:block;padding-inline-start:10px;padding-inline-end:10px;font-size:14px;line-height:30px;text-decoration:none;background-color:var(--tag-bg);border:2px solid var(--tag-text);color:var(--tag-text);border-radius:10px;transition:transform .1s;font-family:arial-rounded-bold;box-shadow:1px 1px}.note-tags a:before{content:"#";margin-right:.25rem}.note-tags a:hover{transform:scale(1.05)}.note-tags sup{font-size:xx-small;vertical-align:super}.note-tags li{display:inline-block;padding-right:10px;padding-bottom:5px;padding-top:5px}.tag{display:inline-block;padding:.25rem .75rem;margin:1rem .5rem 0 0;font-size:1rem;font-family:Inter,sans-serif;line-height:130%;border-radius:.5rem;text-decoration:none;position:relative;top:0;transition:.35s}.menu ul{list-style-type:none;margin-right:20px;margin-left:20px;padding:0}ul{padding-inline-start:20px;padding-bottom:10px;margin-block-start:0px;margin-block-end:0px}.menu ul li{text-align:right;font-family:Inter,serif;font-size:1.2em;padding-top:10px;padding-bottom:10px}.menu{text-align:right;display:none;position:absolute;background-color:var(--base-color);box-shadow:-10px 0 30px -15px #0000002b;right:0;position:fixed;z-index:499;top:65px;bottom:0}.menu a{text-decoration:none;color:#000}#toggle{display:none}#toggle:checked+#menu{display:flex}.sticky{position:-webkit-sticky;position:sticky;z-index:2}#navbar-desktop{background-color:var(--base-color);display:flex;flex-wrap:wrap;align-items:center;justify-content:space-around;z-index:500;position:fixed;top:0;left:0;width:100%}#navbar-desktop[stuck]{opacity:0;transition:opacity 1s,transform 1.3s}#navbar-mobile{background-color:var(--base-color);display:flex;flex-wrap:wrap;align-items:center;justify-content:space-around;z-index:500;position:fixed;top:0;left:0;width:100%}.navigation{flex:1}.navigation ul{justify-content:space-between;display:flex;list-style-type:none;margin:0;padding:0}.navigation ul a{text-decoration:none;display:flex;color:#000}.small-font{font-size:small}.large-font{font-size:large}.column-page{margin-top:52px;padding-bottom:50px;display:grid;grid-template-areas:"left content right""left footer right";background:linear-gradient(to left,var(--base-color),var(--base-color));background-blend-mode:multiply,normal,normal,normal}.wide-column-page{background-color:var(--base-color);padding-bottom:50px;display:grid;grid-template-areas:"left content right""left footer right"}.wide-column-page-content{background-color:var(--base-color);grid-area:content;text-align:justify;position:relative}.notes-list{text-align:right;grid-area:left;list-style-position:inside;list-style:none;margin:0;padding:0}.notes-list-link{text-align:right}.notes-list-link a{text-decoration:none;color:inherit}.notes-list-link a:hover{font-weight:700;font-style:normal}h3 span{font-weight:400}.note-content .download-button{display:inline-block;padding:.25rem .5rem;border-radius:0;border:2px dashed #000;font-size:smaller}.download-button{display:inline-block;padding:.25rem .5rem;border-radius:0;border:2px dashed #000;font-size:smaller;text-decoration:none;color:inherit}.download-button:hover{background-color:var(--link-hover-color);color:#fff;transition:color .2s ease;font-weight:700;opacity:1}.menu li .resume-button{text-decoration:none;color:#fff;background-color:#000;border-radius:5px;line-height:1em;padding:8px 0 8px 10px;align-items:center;font-size:small;z-index:400}.portfolio-button{text-decoration:none;color:#fff;background-color:#000;border-radius:5px;line-height:1em;margin-right:10px;padding:4px 0 4px 10px;align-items:center;font-size:small;display:flex}.portfolio-icon{margin-left:3px;margin-right:4px}[class*=" icon-"].portfolio-icon::before,[class^=icon-].portfolio-icon::before{font-size:16px}[class*=" icon-"].tags-icon::before,[class^=icon-].tags-icon::before{font-size:16px}.navbar-icon{color:#000;margin-left:5px;margin-right:5px}.anchor-link{text-decoration:none}.anchor-symbol{color:#cecece}.anchor-symbol:hover{color:#000;transition:color .2s ease;font-weight:700;opacity:1}.screen-reader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}figcaption{font-family:Inconsolata,monospace;font-style:normal;font-weight:700;font-size:13px;letter-spacing:.02em;line-height:1.6em;color:rgba(53,53,53,.8)}.images-row{display:flex;margin:20px -5px}.images-row picture{margin:0 5px}.images-row figure picture{margin:0}.images-row figure{margin:0 5px 20px 5px}.images-row img{display:inline-block;max-width:100%;width:auto;height:100%;border-radius:var(--image-border-radius)}li{margin:0;padding:0;font-family:Inconsolata,monospace;text-align:justify;font-style:normal;font-size:16px;letter-spacing:.02em;line-height:1.6em}p img{max-width:100%;border-radius:var(--image-border-radius);display:block;margin-left:auto;margin-right:auto;border-style:none;margin:1.25em 0}p img[width][height]{height:100%}figure img[width][height]{height:100%}.note-video{display:block;margin-left:auto;margin-right:auto;margin-top:30px;margin-bottom:30px}.blob-num{border-right:1px solid #ddd}.gist-meta a{color:#3b5998!important;font-weight:700;text-decoration:none}.gist-meta a:hover{text-decoration:underline!important}.hover-highlight::before{content:"";position:absolute;width:100%;height:100%;top:0;left:0;z-index:-1;border-radius:var(--marker-roundness);background-image:linear-gradient(104deg,rgba(0,0,0,0) .9%,rgba(var(--highlighter-color),1.25) 2.4%,rgba(var(--highlighter-color),.5) 5.8%,rgba(var(--highlighter-color),.25) 93%,rgba(var(--highlighter-color),.7) 96%,rgba(0,0,0,0) 98%),linear-gradient(183deg,rgba(0,0,0,0) 0,rgba(var(--highlighter-color),.3) 7.9%,rgba(0,0,0,0) 15%);transform:rotate(-5deg);-webkit-box-decoration-break:clone;box-decoration-break:clone;background-size:0 100%;background-repeat:no-repeat;transition:.3s}.hover-highlight{position:relative;overflow:hidden;padding:.1em 15px}.hover-highlight:hover:before{background-size:100% 100%}.navbar-element-active.hover-highlight:before{background-size:100% 100%}mark{background-color:mark;color:marktext;padding:.1em 5px;margin-right:-5px;margin-left:-5px;border-radius:var(--marker-roundness);-webkit-box-decoration-break:clone;box-decoration-break:clone;background:linear-gradient(104deg,rgba(0,0,0,0) .9%,rgba(var(--marker-color),1.25) 2.4%,rgba(var(--marker-color),.5) 5.8%,rgba(var(--marker-color),.25) 93%,rgba(var(--marker-color),.7) 96%,rgba(0,0,0,0) 98%),linear-gradient(183deg,rgba(0,0,0,0) 0,rgba(var(--marker-color),.3) 7.9%,rgba(0,0,0,0) 15%)}figure{display:block;margin-left:auto;margin-right:auto;margin-top:30px;margin-bottom:30px}picture{display:flex;justify-content:center;margin:0}figcaption{display:flex;justify-content:center}#profile-picture{width:50px;height:50px;border-radius:9999px}.navbar-nav{padding:5px}.navbar-nav>.active{color:#282828;font-weight:700}.navbar-element{font-size:large;color:#1b1b1b;text-decoration:none;font-family:arial-rounded-bold;margin-left:1rem;margin-right:1rem}.navbar-element:hover{color:var(--navbar-element-color)}.navbar-element-active{color:var(--navbar-element-color)}summary{list-style:none;border:2px solid #000;padding:.75em 1em;border-radius:0;cursor:pointer;position:relative;padding-left:calc(1.75rem + .75rem + .75rem)}summary:before{position:absolute;top:50%;transform:translateY(-50%);left:.75rem;content:"↓";width:1.75rem;height:1.75rem;background-color:#000;color:#fff;display:inline-flex;justify-content:center;align-items:center;flex-shrink:0}details[open] summary{background-color:#e7e7e7}details[open] summary:before{content:"↑"}details div{border-left:2px solid #000;border-right:2px solid #000;border-bottom:2px solid #000;padding:1em}details{margin-top:10px;margin-bottom:10px}summary:hover{background-color:#e7e7e7}@font-face{font-family:icons;src:url('/assets/fonts/icons.woff2?7673508') format('woff2'),url('/assets/fonts/icons.woff?7673508') format('woff'),url('/assets/fonts/icons.svg?7673508#icons') format('svg');font-weight:400;font-style:normal;font-display:swap}.footer-icon{color:#bebebe}.footer-icon:hover{color:#3c3c3c}[class*=" icon-"]:before,[class^=icon-]:before{font-family:icons;font-style:normal;font-weight:400;display:inline-block;text-decoration:inherit;font-size:24px;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-tag:before{content:"\e935"}.icon-eye:before{content:"\e9ce"}.icon-arrow-up:before{content:"\ea3a"}.icon-twitter:before{content:"\ea96"}.icon-github:before{content:"\eab0"}.icon-linkedin:before{content:"\eac9"}@media only screen and (max-device-width:1920px){#navbar-mobile{display:none}#back-to-top-mobile{display:none}p img[width]{width:50%}figure img[width]{width:50%}}@media only screen and (max-device-width:576px){#navbar-mobile{display:flex}#navbar-desktop{display:none}#back-to-top-mobile{display:block}#back-to-top-desktop{display:none}p img[width]{width:100%}figure img[width]{width:100%}video[width]{width:100%}}@media (min-width:350px){.column-page,.note{grid-template-columns:auto 340px auto}.wide-column-page{grid-template-columns:auto 340px auto}}@media (min-width:450px){.column-page,.note{grid-template-columns:auto 400px auto}.wide-column-page{grid-template-columns:auto 400px auto}}@media (min-width:576px){.column-page,.note{grid-template-columns:auto 500px auto}.wide-column-page{grid-template-columns:auto 500px auto}}@media (min-width:768px){.column-page,.note{grid-template-columns:auto 500px auto}.wide-column-page{grid-template-columns:auto 750px auto}}@media (min-width:992px){.column-page,.note{grid-template-columns:auto 700px auto}.wide-column-page{grid-template-columns:auto 900px auto}}@media (min-width:1200px){.column-page,.note{grid-template-columns:auto 700px auto}.wide-column-page{grid-template-columns:auto 1150px auto}}@media (min-width:1400px){.column-page,.note{grid-template-columns:auto 700px auto}.wide-column-page{grid-template-columns:auto 1350px auto}}.timeline{margin-top:40px;margin-bottom:40px}.timeline-list{position:relative;padding-left:45px;list-style:none}.timeline-event p{position:relative;top:-5px;margin:0;text-align:left}.timeline-event .year{font-size:small;padding:0;margin:0;font-weight:700;color:#6e6e6e}.timeline-event{position:relative}.timeline-event.is-not-done{padding-bottom:30px}.timeline-event.is-done{padding-bottom:15px}.timeline-event:before{display:inline-block;content:'';position:absolute;left:-37px;height:100%;width:10px}.timeline-event::after{content:'';display:inline-block;position:absolute;top:0;left:-44px;width:12px;height:12px;border:2px solid #000;border-radius:50%;background-color:#fff}.timeline-event.is-not-done::before{border-left:3px dotted #000}.timeline-event.is-done:not(:last-child)::before{border-left:3px solid #000}.timeline-event.is-done::after{font-size:10px;border:2px solid #000;background-color:#000}.left-section{margin-top:122px;float:left;width:50%;min-height:100%;display:flex;flex-direction:column;background-color:var(--base-color);position:fixed}.left-section-content{display:flex;flex-direction:column;align-items:center;justify-content:center}body,html{height:100%;margin:0}.right-section{margin-top:82px;float:right;width:50%;min-height:100%;background-color:var(--base-color)}.right-section .column-page-content{padding-left:15%;padding-right:15%}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}.px-50{padding-left:.5rem;padding-right:.5rem}.px-75{padding-left:.75rem;padding-right:.75rem}.px-150{padding-left:1.5rem;padding-right:1.5rem}.py-50{padding-top:.5rem;padding-bottom:.5rem}.py-75{padding-top:.75rem;padding-bottom:.75rem}.py-100{padding-top:1rem;padding-bottom:1rem}.rounded-25{border-radius:.25rem}.c-gray{color:#282828}.bg-gray-hover:hover{background:#f4f4f4}.no-underline{text-decoration:none}.align-right{text-align:right;list-style-position:inside}.note-entry-header h3{padding-top:0}.note-entry-header span{padding-right:5px}.note-entry-content h3{padding-bottom:0}.project-entry-content h3{padding-bottom:0}.note-content iframe{padding:0;margin:0;width:100%;display:block}@font-face{font-family:arial-rounded-regular;src:url('/assets/fonts/arial-rounded.woff2') format('woff2'),url('/assets/fonts/arial-rounded.woff') format('woff');font-weight:400;font-style:normal}@font-face{font-family:arial-rounded-bold;src:url('/assets/fonts/arial-rounded-bold.woff2') format('woff2'),url('/assets/fonts/arial-rounded-bold.woff') format('woff');font-weight:400;font-style:normal}.projects{margin:0 auto;display:grid;grid-gap:1rem;grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}.project-entry{position:relative;background:#fff;border-radius:10px;transition:transform .2s;border:1px solid #f0f0f0}.project-entry-image{border-radius:10px 10px 0 0;height:100px;object-fit:cover;width:100%}.project-entry:active{transform:scale(.95)}.project-entry-content{padding:15px}.project-entry-description{margin:8px 0;color:var(--gray);font-size:14px;line-height:1.6;overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.project-entry-footer{color:var(--gray);font-size:12px}.project-entry-link{position:absolute;left:0;right:0;top:0;bottom:0}.project-image{border-radius:10px}.action-buttons{display:flex;justify-content:space-evenly}.action-button-link{position:absolute;left:0;right:0;top:0;bottom:0}.action-button:hover{transform:scale(1.02)}.column-page-content .action-button p{text-align:center;margin:0}.action-button{max-width:fit-content;width:100%;display:block;font-size:14px;line-height:30px;color:#fff;text-decoration:none;background:#000;border-radius:10px;transition:transform .1s;position:relative;padding:12px;margin-bottom:20px}.devlog-entry{max-width:740px;margin:6rem auto;padding:2rem;padding-left:280px;clear:both;display:flex;flex-direction:column;position:relative;text-decoration:none}.devlog-entry-link{position:absolute;top:0;bottom:0;left:0;right:inherit}.devlog-entry-title h2{padding-top:0;padding-bottom:5px;font-weight:bolder}.devlog-entry-body{display:flex;flex-direction:column;padding:2rem}.devlog-entry-body .devlog-entry-description{margin-bottom:10px;padding:0;font-family:Inconsolata,monospace;text-align:justify;font-style:normal;font-size:16px;letter-spacing:.02em;line-height:1.6em}.devlog-entry-image{box-shadow:0 0 0 rgb(50 115 235 / 0%);border-radius:8px;position:absolute;left:0;top:0;bottom:0;width:280px;overflow:hidden;transition:all .2s ease}.devlog-entry-image img{width:100%;height:100%;max-width:100%;max-height:100%;object-fit:cover;object-position:center}.devlog-entry:active{transform:scale(.95)}.note-entry{border-radius:8px;border:2px solid #000;box-shadow:2px 2px;overflow:hidden;margin-bottom:20px;position:relative}.note-entry-grid{display:grid;grid-template-columns:70% 30%;grid-gap:0px;background:#fffF}.note-entry-header h3{margin:0;font-size:16px}.note-entry-description{margin:12px 0;color:#000;line-height:1.6;overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.note-entry-description p{margin:0;font-family:Inconsolata,monospace;text-align:left;font-style:normal;font-size:16px;line-height:1.4em}.note-entry-footer{color:#000;font-size:smaller;font-family:arial-rounded-bold}.note-entry-main{padding:14px}.note-entry-image{padding:0;position:relative;grid-column:2;max-height:100%;max-width:100%}.note-entry-image img{width:100%;height:140px;display:block;object-fit:cover}.note-entry-link{position:absolute;left:0;right:0;top:0;bottom:0}.bold{font-weight:700}.tags-header{display:flex;align-items:center;padding-top:0;padding-bottom:0;margin-bottom:20px;margin-top:40px}.tags-header h2{padding:0;margin:0;text-align:left}.home-header{align-items:center;justify-content:space-between;padding-top:0;padding-bottom:0}.home-header h2{padding:0;margin:0;text-align:left}.home-header img{width:6rem;height:6rem;border-radius:100%;flex-grow:0;flex-shrink:0;margin-right:0}.back-to-top-mobile{position:absolute;top:116vh;right:0;bottom:0}.back-to-top-mobile a{padding:.5rem;position:-webkit-sticky;position:sticky;top:91vh;text-decoration:none;display:inline-block;text-align:center;transition:top .4s ease 0s;color:#000;background-color:#fff;border-radius:.25rem;box-shadow:0 8px 15px rgba(0,0,0,.1)}.back-to-top-desktop{position:absolute;top:120vh;bottom:0;right:-100px}.back-to-top-desktop a{padding:.5rem;position:-webkit-sticky;position:sticky;top:90vh;text-decoration:none;display:flex;align-items:center;justify-content:center;transition:top .4s ease 0s;color:#3c3c3c;background-color:#fff;box-shadow:0 4px 10px rgba(0,0,0,.1);border-radius:50%;width:2rem;height:2rem;line-height:2rem}.icon-arrow-up:before{margin-top:8px}.back-to-top-desktop a:hover{top:85vh;color:#aaa}::-webkit-scrollbar{width:22px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:var(--scrollbar-color);border:5px solid var(--base-color);border-radius:8px}::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.25)}code[class*=language-],pre[class*=language-]{color:#d6deeb;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:.9em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:rgba(29,59,83,.99)}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:rgba(29,59,83,.99)}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:1.25em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{color:#fff;background:#011627;border-radius:4px}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.prolog{color:#637777;font-style:italic}.token.punctuation{color:#c792ea}.namespace{color:#b2ccd6}.token.deleted{color:rgba(239,83,80,.56);font-style:italic}.token.property,.token.symbol{color:#80cbc4}.token.keyword,.token.operator,.token.tag{color:#7fdbca}.token.boolean{color:#ff5874}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.doctype,.token.selector{color:#c792ea;font-style:italic}.token.attr-name,.token.inserted{color:#addb67;font-style:italic}.language-css .token.string,.style .token.string,.token.entity,.token.string,.token.url{color:#addb67}.token.atrule,.token.attr-value,.token.class-name{color:#ffcb8b}.token.important,.token.regex,.token.variable{color:#d6deeb}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}pre::-webkit-scrollbar-thumb{background:#6e6e6e;border:5px solid;border-radius:8px;border-color:#011627}pre::-webkit-scrollbar-thumb:hover{background:#969696}</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">

    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>

    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

<!-- ICONS -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22><text y=%2224%22 font-size=%2224%22>💦</text></svg>">
<link rel="preload" as="font" href="/assets/fonts/icons.woff2?7673508" type="font/woff2" crossorigin="crossorigin"/>

<!-- INLINED GOOGLE FONTS -->
<link rel="preconnect" as="font" href="https://fonts.gstatic.com">
<style>
  body,
  h1,
  h2,
  h3,
  h5 {
    font-family: 'Inter', serif;
  }
</style>
<style>
  /* latin */
  @font-face {
    font-family: 'Inter';
    font-style: normal;
    font-weight: 700;
    font-display: swap;
    src: url("https://fonts.gstatic.com/s/inter/v3/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7.woff2") format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  }
</style>
<!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">-->

<!-- GOOGLE ANALYTICS -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137365487-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-137365487-1');
  </script>


<!--<script src='/assets/js/script.js' defer></script>-->


    </head>

    <!-- BODY -->
    <body class="fade-in">
            
<style>
    :root {
        --marker-color: var(--yellow);
    }
</style>

<header id="navbar-desktop" class="sticky py-100">
  <nav class="navbar-nav">
    <!--<a href="/" aria-label="Home page." class="hover-highlight  navbar-element" style="--highlighter-color: 235, 204, 255; --navbar-element-color: #803fab">/ home</a>-->
    <a href="/notes" aria-label="All notes." class="hover-highlight  navbar-element" style="--highlighter-color: 185,231,236; --navbar-element-color: #0b85ff">/ notes</a>
    <a href="/about" aria-label="About me." class="hover-highlight  navbar-element" style="--highlighter-color: 255, 234, 71; --navbar-element-color: #f4ad43">/ about</a>
  </nav>
</header>

<!-- https://cutcodedown.com/tutorial/mobileMenu-->
<!--https://medium.com/@heyoka/responsive-pure-css-off-canvas-hamburger-menu-aebc8d11d793-->
<header id="navbar-mobile" class="sticky py-100">
   <nav class="navbar-nav">
    <!--<a href="/" aria-label="Home page." class="hover-highlight  navbar-element" style="--highlighter-color: 235, 204, 255; --navbar-element-color: #803fab">/ home</a>-->
    <a href="/notes" aria-label="All notes." class="hover-highlight  navbar-element" style="--highlighter-color: 185,231,236; --navbar-element-color: #0b85ff">/ notes</a>
    <a href="/about" aria-label="About me." class="hover-highlight  navbar-element" style="--highlighter-color: 255, 234, 71; --navbar-element-color: #f4ad43">/ about</a>
  </nav>

  

</header>



<div class="note column-page">
    <div class="note-content column-page-content">
        <h1 class="note-title">💦
            Creating a Stylized Water Shader</h1>
        <div class="note-subtitle"><p class="reading-time"><b>20</b> minute read</p></div>
        <h2 id="introduction" tabindex="-1"><a class="anchor-link" href="#introduction" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Introduction</h2>
<p>In this tutorial I will explain step-by-step how to create a beautiful stylized water shader in Unity using Shader Graph. The goal is not to generate a physically accurate result, but rather to achieve a <mark>real-time, controllable and good-looking</mark> stylized water shader.</p>
<p>// TODO: Add video of end result.</p>
<h2 id="1.-requirements-and-initial-set-up" tabindex="-1"><a class="anchor-link" href="#1.-requirements-and-initial-set-up" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 1. Requirements and initial set up</h2>
<blockquote>
<p>This tutorial has been made with <em><strong>Unity 2022.2.6f1</strong></em> and <em><strong>Universal RP 14.0.6</strong></em>.</p>
</blockquote>
<h3 id="required-settings" tabindex="-1"><a class="anchor-link" href="#required-settings" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Required settings</h3>
<p>Before starting, make sure to enable the <em><strong>depth/opaque textures</strong></em> in the URP pipeline asset settings in your project.</p>
<p>// TODO: Add image of opaque and depth texture toggled on</p>
<h3 id="initial-setup" tabindex="-1"><a class="anchor-link" href="#initial-setup" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Initial setup</h3>
<p>First, we create a new <em><strong>Unlit Shader Graph shader</strong></em>. The shader material should be set the <em><strong>Unlit</strong></em> and the surface type to <em><strong>Opaque</strong></em>.</p>
<p><picture><source type="image/webp" srcset="shader-settings.png-400w.webp 400w, shader-settings.png-600w.webp 600w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="shader-settings.png-400w.jpeg 400w, shader-settings.png-600w.jpeg 600w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:50%;" loading="lazy" decoding="async" src="shader-settings.png-400w.jpeg" width="600" height="1004"></picture></p>
<p>For the scene, I have created a small scene with a ground plane and some simple geometry.</p>
<p>// TODO: Add image of scene.</p>
<p>I added a water plane and assigned it a material that I created that uses the shader we just created. In the material settings, be sure to set the queue to <em><strong>Transparent</strong></em>.</p>
<p><picture><source type="image/webp" srcset="material-settings.png-400w.webp 400w, material-settings.png-800w.webp 800w, material-settings.png-1040w.webp 1040w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="material-settings.png-400w.jpeg 400w, material-settings.png-800w.jpeg 800w, material-settings.png-1040w.jpeg 1040w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="material-settings.png-400w.jpeg" width="1040" height="220"></picture></p>
<p>During the tutorial, newly added nodes will be marked in green so you can follow along to create the shader yourself.</p>
<h2 id="2.-figuring-out-the-depth-of-the-water" tabindex="-1"><a class="anchor-link" href="#2.-figuring-out-the-depth-of-the-water" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 2. Figuring out the depth of the water</h2>
<p>The single most important step in creating our water shader is <mark>figuring out the depth of the water</mark>. We will use the depth value it to drive many other effects of our water such as color, opacity, refraction and foam.</p>
<h3 id="camera-relative-depth" tabindex="-1"><a class="anchor-link" href="#camera-relative-depth" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Camera-relative depth</h3>
<p>Most water shader tutorials use some variation of the following node setup to calculate a depth fade value that goes from shallow (1, white) to deep (0, black).</p>
<p><picture><source type="image/webp" srcset="camera-relative-depth-fade.png-400w.webp 400w, camera-relative-depth-fade.png-800w.webp 800w, camera-relative-depth-fade.png-1200w.webp 1200w, camera-relative-depth-fade.png-2018w.webp 2018w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="camera-relative-depth-fade.png-400w.jpeg 400w, camera-relative-depth-fade.png-800w.jpeg 800w, camera-relative-depth-fade.png-1200w.jpeg 1200w, camera-relative-depth-fade.png-2018w.jpeg 2018w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="camera-relative-depth-fade.png-400w.jpeg" width="2018" height="532"></picture></p>
<p>In this node setup, the <em><strong>Scene Depth (Eye)</strong></em> node returns the distance (in world space units, meters) between the camera and the objects below the water. You can imagine it by tracing an imaginary ray from the camera towards the water that stops when it first hits an object under the water surface. The distance of this ray is what is returned by the node.</p>
<p>// TODO: Add diagram of scene depth (eye).</p>
<p>What we actually care about is not the distance between the camera and the objects under the water, but <mark>the distance between the surface of the water and the objects under the water</mark>. For this, we can use the alpha component of the <em><strong>Screen Position (Raw)</strong></em> node which gives us the distance between the camera and the water surface. We can then <em><strong>Subtract</strong></em> the 2 distances to get the desired distance which represents the depth of the water.</p>
<p><picture><source type="image/webp" srcset="subtract-depths.png-400w.webp 400w, subtract-depths.png-800w.webp 800w, subtract-depths.png-1122w.webp 1122w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="subtract-depths.png-400w.jpeg 400w, subtract-depths.png-800w.jpeg 800w, subtract-depths.png-1122w.jpeg 1122w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="subtract-depths.png-400w.jpeg" width="1122" height="586"></picture></p>
<p>Finally we <em><strong>Divide</strong></em> by a depth range/distance control parameter, <em><strong>Saturate</strong></em> the output (clamp betweemn 0 and 1) and then perform a <em><strong>One Minus</strong></em> operation to get a white value near the shore and a black value in the deep parts of the water.</p>
<p><picture><source type="image/webp" srcset="process-depths.png-400w.webp 400w, process-depths.png-800w.webp 800w, process-depths.png-1200w.webp 1200w, process-depths.png-1552w.webp 1552w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="process-depths.png-400w.jpeg 400w, process-depths.png-800w.jpeg 800w, process-depths.png-1200w.jpeg 1200w, process-depths.png-1552w.jpeg 1552w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="process-depths.png-400w.jpeg" width="1552" height="388"></picture></p>
<p>It is very important to note that this calculated depth value is not the vertical depth of the water. If you were looking at the water and shooting an invisible ray from your eye towards a point of the water, the distance that the ray would travel between hitting the surface of the water and hitting the ground below the water surface is the distance that you get here from these nodes. This means that when looking at the same point on the water surface, the returned depth value depends on how shallow the angle is under which you are looking at the water surface. This effect/artifact can be seen in the video below when moving around the camera.</p>
<p>// TODO: Add video of depth values changing when moving camera.</p>
<h3 id="world-space-depth" tabindex="-1"><a class="anchor-link" href="#world-space-depth" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> World-space depth</h3>
<p>Personally I am not a fan of how the depth effect looks using the previous method. The perceived depth values change when moving around your camera and I would rather have a constant depth value that is independent of camera position. To 'fix' this, I have figured out an alternative way to calculate the depth.</p>
<p>// TODO: Explain method step by step with diagrmas and more text</p>
<p><picture><source type="image/webp" srcset="world-space-depth-fade.png-400w.webp 400w, world-space-depth-fade.png-800w.webp 800w, world-space-depth-fade.png-1200w.webp 1200w, world-space-depth-fade.png-1998w.webp 1998w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="world-space-depth-fade.png-400w.jpeg 400w, world-space-depth-fade.png-800w.jpeg 800w, world-space-depth-fade.png-1200w.jpeg 1200w, world-space-depth-fade.png-1998w.jpeg 1998w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="world-space-depth-fade.png-400w.jpeg" width="1998" height="618"></picture></p>
<p>This node setup gives you the depth of the water as if you would put a measuring tape vertically into the water and measure the distance from the surface of the water to the seabed. When moving the camera around, the calculated depth values do not change.</p>
<p>// TODO: Show video of camera moving around.</p>
<h3 id="depth-fade-subgraph" tabindex="-1"><a class="anchor-link" href="#depth-fade-subgraph" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Depth Fade subgraph</h3>
<p>It is a good idea to put all of the nodes we just created into a <em><strong>Depth Fade</strong></em> subgraph. This will make our main graph clean and organized.</p>
<p><picture><source type="image/webp" srcset="depth-fade-subgraph.png-400w.webp 400w, depth-fade-subgraph.png-800w.webp 800w, depth-fade-subgraph.png-1200w.webp 1200w, depth-fade-subgraph.png-1278w.webp 1278w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="depth-fade-subgraph.png-400w.jpeg 400w, depth-fade-subgraph.png-800w.jpeg 800w, depth-fade-subgraph.png-1200w.jpeg 1200w, depth-fade-subgraph.png-1278w.jpeg 1278w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="depth-fade-subgraph.png-400w.jpeg" width="1278" height="396"></picture></p>
<h2 id="3.-colors-and-opacity" tabindex="-1"><a class="anchor-link" href="#3.-colors-and-opacity" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 3. Colors and opacity</h2>
<p>In this section we will add color to our water surface.</p>
<h3 id="shallow-and-deep" tabindex="-1"><a class="anchor-link" href="#shallow-and-deep" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Shallow and deep</h3>
<p>Now that we know the depth of our water, we can use it to drive the colors and transparency of our water. We can simply use the output of our <em><strong>Depth Fade</strong></em> subgraph (which is a value between 0 and 1) to <em><strong>Lerp</strong></em> between a shallow water color and a deep water color.</p>
<p><picture><source type="image/webp" srcset="shallow-deep-lerp.png-400w.webp 400w, shallow-deep-lerp.png-800w.webp 800w, shallow-deep-lerp.png-1200w.webp 1200w, shallow-deep-lerp.png-1306w.webp 1306w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="shallow-deep-lerp.png-400w.jpeg 400w, shallow-deep-lerp.png-800w.jpeg 800w, shallow-deep-lerp.png-1200w.jpeg 1200w, shallow-deep-lerp.png-1306w.jpeg 1306w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="shallow-deep-lerp.png-400w.jpeg" width="1306" height="398"></picture></p>
<details>
<summary>Going the extra mile: HSV lerping</summary>
<div>
<p>As explained by Alan Zucconi in <a href="https://www.alanzucconi.com/2016/01/06/colour-interpolation/" target="_blank" rel="noopener noreferrer">this great article about colour interpolation</a>, we can improve the appearance of the color of our water by lerping in HSV space instead of RGB space. To do this in Shader Graph, a custom function node can be used that converts our RGB colors to HSV, lerps in HSV space and then converts them back to RGB.</p>
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">half3</span> <span class="token function">RGBToHSV</span><span class="token punctuation">(</span><span class="token keyword">half3</span> In<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">half4</span> K <span class="token operator">=</span> <span class="token keyword">half4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half4</span> P <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token keyword">half4</span><span class="token punctuation">(</span>In<span class="token punctuation">.</span>bg<span class="token punctuation">,</span> K<span class="token punctuation">.</span>wz<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">half4</span><span class="token punctuation">(</span>In<span class="token punctuation">.</span>gb<span class="token punctuation">,</span> K<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">step</span><span class="token punctuation">(</span>In<span class="token punctuation">.</span>b<span class="token punctuation">,</span> In<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half4</span> Q <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token keyword">half4</span><span class="token punctuation">(</span>P<span class="token punctuation">.</span>xyw<span class="token punctuation">,</span> In<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">half4</span><span class="token punctuation">(</span>In<span class="token punctuation">.</span>r<span class="token punctuation">,</span> P<span class="token punctuation">.</span>yzx<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">step</span><span class="token punctuation">(</span>P<span class="token punctuation">.</span>x<span class="token punctuation">,</span> In<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half</span> D <span class="token operator">=</span> Q<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token function">min</span><span class="token punctuation">(</span>Q<span class="token punctuation">.</span>w<span class="token punctuation">,</span> Q<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half</span> E <span class="token operator">=</span> <span class="token number">1e-10</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">half3</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>Q<span class="token punctuation">.</span>z <span class="token operator">+</span> <span class="token punctuation">(</span>Q<span class="token punctuation">.</span>w <span class="token operator">-</span> Q<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">6.0</span> <span class="token operator">*</span> D <span class="token operator">+</span> E<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> D <span class="token operator">/</span> <span class="token punctuation">(</span>Q<span class="token punctuation">.</span>x <span class="token operator">+</span> E<span class="token punctuation">)</span><span class="token punctuation">,</span> Q<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">half3</span> <span class="token function">HSVToRGB</span><span class="token punctuation">(</span><span class="token keyword">half3</span> In<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">half4</span> K <span class="token operator">=</span> <span class="token keyword">half4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half3</span> P <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">frac</span><span class="token punctuation">(</span>In<span class="token punctuation">.</span>xxx <span class="token operator">+</span> K<span class="token punctuation">.</span>xyz<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> K<span class="token punctuation">.</span>www<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> In<span class="token punctuation">.</span>z <span class="token operator">*</span> <span class="token function">lerp</span><span class="token punctuation">(</span>K<span class="token punctuation">.</span>xxx<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>P <span class="token operator">-</span> K<span class="token punctuation">.</span>xxx<span class="token punctuation">)</span><span class="token punctuation">,</span> In<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">HSVLerp_half</span><span class="token punctuation">(</span><span class="token keyword">half4</span> A<span class="token punctuation">,</span> <span class="token keyword">half4</span> B<span class="token punctuation">,</span> <span class="token keyword">half</span> T<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">half4</span> Out<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    A<span class="token punctuation">.</span>xyz <span class="token operator">=</span> <span class="token function">RGBToHSV</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>xyz<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    B<span class="token punctuation">.</span>xyz <span class="token operator">=</span> <span class="token function">RGBToHSV</span><span class="token punctuation">(</span>B<span class="token punctuation">.</span>xyz<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">half</span> t <span class="token operator">=</span> T<span class="token punctuation">;</span> <span class="token comment">// used to lerp alpha, needs to remain unchanged</span><br><br>    <span class="token keyword">half</span> hue<span class="token punctuation">;</span><br>    <span class="token keyword">half</span> d <span class="token operator">=</span> B<span class="token punctuation">.</span>x <span class="token operator">-</span> A<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token comment">// hue difference</span><br><br>    <span class="token keyword">if</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>x <span class="token operator">></span> B<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <br>    <span class="token punctuation">{</span><br>        <span class="token keyword">half</span> temp <span class="token operator">=</span> B<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        B<span class="token punctuation">.</span>x <span class="token operator">=</span> A<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        A<span class="token punctuation">.</span>x <span class="token operator">=</span> temp<span class="token punctuation">;</span><br><br>        d <span class="token operator">=</span> <span class="token operator">-</span>d<span class="token punctuation">;</span><br>        T <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">-</span>T<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <br>    <span class="token punctuation">{</span><br>        A<span class="token punctuation">.</span>x <span class="token operator">=</span> A<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><br>        hue <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token punctuation">.</span>x <span class="token operator">+</span> T <span class="token operator">*</span> <span class="token punctuation">(</span>B<span class="token punctuation">.</span>x <span class="token operator">-</span> A<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">&lt;=</span> <span class="token number">0.5</span><span class="token punctuation">)</span> hue <span class="token operator">=</span> A<span class="token punctuation">.</span>x <span class="token operator">+</span> T <span class="token operator">*</span> d<span class="token punctuation">;</span><br><br>    <span class="token keyword">half</span> sat <span class="token operator">=</span> A<span class="token punctuation">.</span>y <span class="token operator">+</span> T <span class="token operator">*</span> <span class="token punctuation">(</span>B<span class="token punctuation">.</span>y <span class="token operator">-</span> A<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half</span> val <span class="token operator">=</span> A<span class="token punctuation">.</span>z <span class="token operator">+</span> T <span class="token operator">*</span> <span class="token punctuation">(</span>B<span class="token punctuation">.</span>z <span class="token operator">-</span> A<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">half</span> alpha <span class="token operator">=</span> A<span class="token punctuation">.</span>w <span class="token operator">+</span> t <span class="token operator">*</span> <span class="token punctuation">(</span>B<span class="token punctuation">.</span>w <span class="token operator">-</span> A<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">half3</span> rgb <span class="token operator">=</span> <span class="token function">HSVToRGB</span><span class="token punctuation">(</span><span class="token keyword">half3</span><span class="token punctuation">(</span>hue<span class="token punctuation">,</span>sat<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <br>    Out <span class="token operator">=</span> <span class="token keyword">half4</span><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>The custom function node then fits in like this.</p>
<p><picture><source type="image/webp" srcset="hsv-lerp.png-400w.webp 400w, hsv-lerp.png-800w.webp 800w, hsv-lerp.png-1200w.webp 1200w, hsv-lerp.png-1888w.webp 1888w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="hsv-lerp.png-400w.jpeg 400w, hsv-lerp.png-800w.jpeg 800w, hsv-lerp.png-1200w.jpeg 1200w, hsv-lerp.png-1888w.jpeg 1888w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="hsv-lerp.png-400w.jpeg" width="1888" height="380"></picture></p>
<p>When looking at the water, you can see that the intermediate colors between shallow and deep appear more vibrant.</p>
<p>// TODO: Show video of color lerping</p>
</div>
</details>
<details>
<summary>Going the extra mile: Posterize</summary>
<div>
<p>A cool and easy effect to add is posterization. We simply add the <mark>Posterize</mark> node and add a property to control the number of steps.</p>
<p><picture><source type="image/webp" srcset="posterize.png-400w.webp 400w, posterize.png-800w.webp 800w, posterize.png-1200w.webp 1200w, posterize.png-1884w.webp 1884w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="posterize.png-400w.jpeg 400w, posterize.png-800w.jpeg 800w, posterize.png-1200w.jpeg 1200w, posterize.png-1884w.jpeg 1884w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="posterize.png-400w.jpeg" width="1884" height="676"></picture></p>
<p>A good example of where such a posterization technique was used is in the game <a href="https://ashorthike.com/" target="_blank" rel="noopener noreferrer">A Short Hike</a>. In the image below you can see the different color bands which are a result of the posterization.</p>
<p><picture><source type="image/webp" srcset="a-short-hike.png-400w.webp 400w, a-short-hike.png-800w.webp 800w, a-short-hike.png-1200w.webp 1200w, a-short-hike.png-2548w.webp 2548w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="a-short-hike.png-400w.jpeg 400w, a-short-hike.png-800w.jpeg 800w, a-short-hike.png-1200w.jpeg 1200w, a-short-hike.png-2548w.jpeg 2548w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="a-short-hike.png-400w.jpeg" width="2548" height="1440"></picture></p>
</div>
</details>
<details>
<summary>Bonus tip: Use a gradient</summary>
<div>
<p>If you want even more control over the colors of your water, you can make use of a gradient texture to drive the color. In the example below I have a gradient that I turn into a 256x1 texture that I then sample using the [0,1] depth value. The step to convert from a gradient to a texture is needed because Shader Graph does not support gradient properties.</p>
<p><picture><source type="image/webp" srcset="gradient.png-400w.webp 400w, gradient.png-476w.webp 476w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="gradient.png-400w.jpeg 400w, gradient.png-476w.jpeg 476w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:70%;" loading="lazy" decoding="async" src="gradient.png-400w.jpeg" width="476" height="190"></picture></p>
<p>This setup allows you to do both hard and soft transitions just like the <em><strong>Posterize</strong></em> method.</p>
<p>Below is the code I used to convert from a gradient to a texture.</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span><br><span class="token preprocessor property">#<span class="token directive keyword">if</span> UNITY_EDITOR</span><br><span class="token keyword">using</span> <span class="token namespace">UnityEditor</span><span class="token punctuation">;</span><br><span class="token preprocessor property">#<span class="token directive keyword">endif</span></span><br><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span><br><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GradientTextureMaker</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> width <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span><br>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> height <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// needs to be multiple of 4 for DXT1 format compression</span><br><br>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Texture2D</span> <span class="token function">CreateGradientTexture</span><span class="token punctuation">(</span><span class="token class-name">Material</span> targetMaterial<span class="token punctuation">,</span> <span class="token class-name">Gradient</span> gradient<span class="token punctuation">)</span><br>    <span class="token punctuation">{</span><br>        <span class="token class-name">Texture2D</span> gradientTexture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Texture2D</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> TextureFormat<span class="token punctuation">.</span>ARGB32<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            name <span class="token operator">=</span> <span class="token string">"_gradient"</span><span class="token punctuation">,</span><br>            filterMode <span class="token operator">=</span> FilterMode<span class="token punctuation">.</span>Point<span class="token punctuation">,</span><br>            wrapMode <span class="token operator">=</span> TextureWrapMode<span class="token punctuation">.</span>Clamp<br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> gradientTexture<span class="token punctuation">.</span><span class="token function">SetPixel</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> gradient<span class="token punctuation">.</span><span class="token function">Evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>i <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        gradientTexture<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        gradientTexture <span class="token operator">=</span> <span class="token function">SaveAndGetTexture</span><span class="token punctuation">(</span>targetMaterial<span class="token punctuation">,</span> gradientTexture<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">return</span> gradientTexture<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Texture2D</span> <span class="token function">SaveAndGetTexture</span><span class="token punctuation">(</span><span class="token class-name">Material</span> targetMaterial<span class="token punctuation">,</span> <span class="token class-name">Texture2D</span> sourceTexture<span class="token punctuation">)</span><br>    <span class="token punctuation">{</span><br>        <span class="token class-name"><span class="token keyword">string</span></span> targetFolder <span class="token operator">=</span> AssetDatabase<span class="token punctuation">.</span><span class="token function">GetAssetPath</span><span class="token punctuation">(</span>targetMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        targetFolder <span class="token operator">=</span> targetFolder<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>targetMaterial<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">".mat"</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        targetFolder <span class="token operator">+=</span> <span class="token string">"Gradient Textures/"</span><span class="token punctuation">;</span><br><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>targetFolder<span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>targetFolder<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            AssetDatabase<span class="token punctuation">.</span><span class="token function">Refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> targetFolder <span class="token operator">+</span> targetMaterial<span class="token punctuation">.</span>name <span class="token operator">+</span> sourceTexture<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">;</span><br>        File<span class="token punctuation">.</span><span class="token function">WriteAllBytes</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> sourceTexture<span class="token punctuation">.</span><span class="token function">EncodeToPNG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        AssetDatabase<span class="token punctuation">.</span><span class="token function">Refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        AssetDatabase<span class="token punctuation">.</span><span class="token function">ImportAsset</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> ImportAssetOptions<span class="token punctuation">.</span>Default<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        sourceTexture <span class="token operator">=</span> <span class="token punctuation">(</span>Texture2D<span class="token punctuation">)</span>AssetDatabase<span class="token punctuation">.</span><span class="token function">LoadAssetAtPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Texture2D</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">return</span> sourceTexture<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
</div>
</details>
<h3 id="horizon-color" tabindex="-1"><a class="anchor-link" href="#horizon-color" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Horizon color</h3>
<p>Next, we will add a color to parts of the water at the horizon. For this, we will use a <em><strong>Fresnel Effect</strong></em> node with a horizon color and horizon distance parameter. We will use the the output of the Depth Color and lerp between that and the Horizon Color.</p>
<p><picture><source type="image/webp" srcset="horizon-color-lerp.png-400w.webp 400w, horizon-color-lerp.png-800w.webp 800w, horizon-color-lerp.png-1200w.webp 1200w, horizon-color-lerp.png-1234w.webp 1234w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="horizon-color-lerp.png-400w.jpeg 400w, horizon-color-lerp.png-800w.jpeg 800w, horizon-color-lerp.png-1200w.jpeg 1200w, horizon-color-lerp.png-1234w.jpeg 1234w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="horizon-color-lerp.png-400w.jpeg" width="1234" height="996"></picture></p>
<p>When you look at the water at a very sharp angle, the horizon color will show up in the distance.</p>
<p>// TODO: Add video of horizon color</p>
<h3 id="underwater-color" tabindex="-1"><a class="anchor-link" href="#underwater-color" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Underwater color</h3>
<p>Right now we are directly setting the color of the water but because we do this, the color of the objects beneath the water gets lost. To fix this, we will take the underwater color into account.</p>
<p><picture><source type="image/webp" srcset="underwater-color.png-400w.webp 400w, underwater-color.png-800w.webp 800w, underwater-color.png-1200w.webp 1200w, underwater-color.png-1604w.webp 1604w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="underwater-color.png-400w.jpeg 400w, underwater-color.png-800w.jpeg 800w, underwater-color.png-1200w.jpeg 1200w, underwater-color.png-1604w.jpeg 1604w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="underwater-color.png-400w.jpeg" width="1604" height="680"></picture></p>
<p>We sample the <em><strong>Scene Color</strong></em> node which returns the color of the geometry below the water surface. Then where we set the other colors to be transparent, we will use the underwater color instead. This is done using the <em><strong>One Minus</strong></em> node. Finally we add the colors we already had with the underwater color to get the final color.</p>
<h2 id="4.-refraction" tabindex="-1"><a class="anchor-link" href="#4.-refraction" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 4. Refraction</h2>
<p>Let's add a cool effect, refraction!</p>
<h3 id="refracted-uvs" tabindex="-1"><a class="anchor-link" href="#refracted-uvs" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Refracted UVs</h3>
<p>Many nodes that we have already used like the <em><strong>Scene Color</strong></em> and <em><strong>Scene Depth</strong></em> nodes have a <em><strong>UV</strong></em> input parameter that we left to the default up until now. We will start by adding a UV parameter to the <em><strong>Depth Fade</strong></em> subgraph and connect it up to the <em><strong>Scene Depth</strong></em> node.</p>
<p><picture><source type="image/webp" srcset="scene-depth-uv.png-400w.webp 400w, scene-depth-uv.png-704w.webp 704w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="scene-depth-uv.png-400w.jpeg 400w, scene-depth-uv.png-704w.jpeg 704w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="scene-depth-uv.png-400w.jpeg" width="704" height="618"></picture></p>
<p>Now that we can control the UVs which the <em><strong>Depth Fade</strong></em> subgraph uses, we can distort those UVs to add a refraction effect. Let's use the following node setup.</p>
<p><picture><source type="image/webp" srcset="refract-uv.png-400w.webp 400w, refract-uv.png-800w.webp 800w, refract-uv.png-1200w.webp 1200w, refract-uv.png-2030w.webp 2030w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="refract-uv.png-400w.jpeg 400w, refract-uv.png-800w.jpeg 800w, refract-uv.png-1200w.jpeg 1200w, refract-uv.png-2030w.jpeg 2030w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="refract-uv.png-400w.jpeg" width="2030" height="502"></picture></p>
<p>In the node setup above, we tile and move some <em><strong>Gradient Noise</strong></em> that we then <em><strong>Remap</strong></em> to a [-1,1] scale, <em><strong>Multiply</strong></em> with a refraction strength parameter and then add to the <em><strong>Screen Position (default)</strong></em> which are the regular, undistorted UVs.</p>
<p>It is a good idea to put these nodes in their own <em><strong>Refracted UV</strong></em> subgraph to make the graph clean and organized. We can then use this refracted UVs and connect them to the UV input of the <em><strong>Depth Fade</strong></em> subgraph as well as the UV input of the <em><strong>Scene Color</strong></em> node we used for the underwater color.</p>
<p>Now we get a nice refraction effect!</p>
<p>// TODO: image of refraction</p>
<details>
<summary>Going the extra mile: Fixing refraction artifacts</summary>
<div>
<p>The refraction we have right now is flawed. When an object sticks out of the water you'll see that the refraction effect is present in places where it should not be.</p>
<p>// TODO: Image of artifacts</p>
<p>One way to solve this is to perform a depth check to see if we should use the distorted or the undistorted UVS. The <em><strong>Scene Position</strong></em> subgraph is a subgraph I created that contains the nodes to calculate the world space scene position that was shown in the first section about calculating the world space depth.</p>
<p><picture><source type="image/webp" srcset="artifact-fix.png-400w.webp 400w, artifact-fix.png-800w.webp 800w, artifact-fix.png-1200w.webp 1200w, artifact-fix.png-1356w.webp 1356w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="artifact-fix.png-400w.jpeg 400w, artifact-fix.png-800w.jpeg 800w, artifact-fix.png-1200w.jpeg 1200w, artifact-fix.png-1356w.jpeg 1356w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="artifact-fix.png-400w.jpeg" width="1356" height="592"></picture></p>
<p>With this fix implemented, the effect looks much better.</p>
<p>// TODO: Image of fixed artifact</p>
</div>
</details>
<h2 id="5.-foam" tabindex="-1"><a class="anchor-link" href="#5.-foam" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 5. Foam</h2>
<p>The next step is to add foam to the water.</p>
<h3 id="surface-foam" tabindex="-1"><a class="anchor-link" href="#surface-foam" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Surface foam</h3>
<h4>Panning UVs</h4>
<p>We will add surface foam to the shader step by step. We will start by setting up the UVs that we will use to sample a surface foam texture. Let's create a subgraph called <em><strong>Panning UVs</strong></em> and add the following nodes.</p>
<p><picture><source type="image/webp" srcset="panning-uv.png-400w.webp 400w, panning-uv.png-800w.webp 800w, panning-uv.png-1200w.webp 1200w, panning-uv.png-1960w.webp 1960w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="panning-uv.png-400w.jpeg 400w, panning-uv.png-800w.jpeg 800w, panning-uv.png-1200w.jpeg 1200w, panning-uv.png-1960w.jpeg 1960w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="panning-uv.png-400w.jpeg" width="1960" height="452"></picture></p>
<p>This subgraph takes in UVs and then adds movement to them as well as some <em><strong>Tiling</strong></em> and an <em><strong>Offset</strong></em>. The nodes on the left are used to convert the direction parameter which is a value between 0 and 1 into a direction vector for the UV movement. You could as well have just a vector input parameter and set the direction yourself, but this approach allows you to work with a <mark>single direction slider between 0 and 1 and control the full 360° range of movement</mark>. For performance reasons, you could leave this out and just directly set the direction.</p>
<h4>Distorted UVs</h4>
<p>Next, we will taked the panning UVs and distort them using some sine functions.</p>
<p><picture><source type="image/webp" srcset="distorted-uv.png-400w.webp 400w, distorted-uv.png-800w.webp 800w, distorted-uv.png-898w.webp 898w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="distorted-uv.png-400w.jpeg 400w, distorted-uv.png-800w.jpeg 800w, distorted-uv.png-898w.jpeg 898w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="distorted-uv.png-400w.jpeg" width="898" height="464"></picture></p>
<p>We take the output of the <em><strong>Panning UV</strong></em> subgraph and plug it into a <em><strong>Custom Function</strong></em> node. For the custom function, we use the following code.</p>
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">void</span> <span class="token function">DistortUV_float</span><span class="token punctuation">(</span><span class="token keyword">float2</span> UV<span class="token punctuation">,</span> <span class="token keyword">float</span> Amount<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">float2</span> Out<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">float</span> time <span class="token operator">=</span> _Time<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>    <br>    UV<span class="token punctuation">.</span>y <span class="token operator">+=</span> Amount <span class="token operator">*</span> <span class="token number">0.01</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">3.5</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.35</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">4.8</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">1.05</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">7.3</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.45</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br>    UV<span class="token punctuation">.</span>x <span class="token operator">+=</span> Amount <span class="token operator">*</span> <span class="token number">0.12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">4.0</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">6.8</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">11.3</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br>    UV<span class="token punctuation">.</span>y <span class="token operator">+=</span> Amount <span class="token operator">*</span> <span class="token number">0.12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">4.2</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.64</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">6.3</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">1.65</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>UV<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">8.2</span> <span class="token operator">+</span> time <span class="token operator">*</span> <span class="token number">0.45</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br><br>    Out <span class="token operator">=</span> UV<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>This code adds a distortion to the UVs using sine functions to make the foam a bit more interesting. You could also recreate this functionality in nodes but a custom function is a bit more compact.</p>
<h4>Sampling the foam texture</h4>
<p>Now that we have moving and distorted UVs, we can use them to sample a foam texture and add it to the surface of our water.</p>
<p><picture><source type="image/webp" srcset="sample-foam-texture.png-400w.webp 400w, sample-foam-texture.png-800w.webp 800w, sample-foam-texture.png-1200w.webp 1200w, sample-foam-texture.png-1218w.webp 1218w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="sample-foam-texture.png-400w.jpeg 400w, sample-foam-texture.png-800w.jpeg 800w, sample-foam-texture.png-1200w.jpeg 1200w, sample-foam-texture.png-1218w.jpeg 1218w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="sample-foam-texture.png-400w.jpeg" width="1218" height="352"></picture></p>
<p>We simply use a <em><strong>Sample Texture 2D</strong></em> node to sample the foam texture and then use a <em><strong>Step</strong></em> node to add a cutoff. Lastly we multiply by a foam color property.</p>
<p>We could simply add the surface foam to the water color using the <em><strong>Add</strong></em> node however I believe we can do a bit better by blending it using the follow <em><strong>Overlay</strong></em> subgraph that we can create.</p>
<p><picture><source type="image/webp" srcset="overlay.png-400w.webp 400w, overlay.png-800w.webp 800w, overlay.png-1200w.webp 1200w, overlay.png-1426w.webp 1426w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="overlay.png-400w.jpeg 400w, overlay.png-800w.jpeg 800w, overlay.png-1200w.jpeg 1200w, overlay.png-1426w.jpeg 1426w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="overlay.png-400w.jpeg" width="1426" height="524"></picture></p>
<p>We can then use this <em><strong>Overlay</strong></em> subgraph to blend between the water color we already had (Base) and the output of the surface foam nodes (Overlay).</p>
<p><picture><source type="image/webp" srcset="blend.png-400w.webp 400w, blend.png-800w.webp 800w, blend.png-1200w.webp 1200w, blend.png-1346w.webp 1346w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="blend.png-400w.jpeg 400w, blend.png-800w.jpeg 800w, blend.png-1200w.jpeg 1200w, blend.png-1346w.jpeg 1346w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="blend.png-400w.jpeg" width="1346" height="788"></picture></p>
<p>Using this, the surface foam can get blended more nicely with the base color.</p>
<p>// TODO: Add video of blend</p>
<h3 id="intersection-foam" tabindex="-1"><a class="anchor-link" href="#intersection-foam" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Intersection foam</h3>
<p>Next we will add foam that gets drawn at the edges of an object where it intersects the water surface.</p>
<h4>Intersection foam mask</h4>
<p>We will start by creating a mask that will define where the intersection foam should show up. For this, we will be using the <em><strong>Depth Fade</strong></em> subgraph.</p>
<p><picture><source type="image/webp" srcset="intersection-mask.png-400w.webp 400w, intersection-mask.png-800w.webp 800w, intersection-mask.png-1200w.webp 1200w, intersection-mask.png-1600w.webp 1600w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="intersection-mask.png-400w.jpeg 400w, intersection-mask.png-800w.jpeg 800w, intersection-mask.png-1200w.jpeg 1200w, intersection-mask.png-1600w.jpeg 1600w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="intersection-mask.png-400w.jpeg" width="1600" height="384"></picture></p>
<p>We use the <em><strong>Depth Fade</strong></em> subgraph to create a dept-based mask and use the <em><strong>Intersection Foam Fade</strong></em> parameter to control the hardness of the mask.</p>
<p>// TODO: Show video of mask and editing parameter</p>
<h4>Sampling the intersection foam</h4>
<p>For the intersection foam, the setup is similar to the surface foam. Again we use the <em><strong>Panning UV</strong></em> subgraph and use those UVs to sample an <em><strong>Intersection Foam Texture</strong></em>. We use an <em><strong>Intersection Foam Cutoff</strong></em> parameter to control where we cut off the foam using a <em><strong>Step</strong></em> node. We multiply this <em><strong>Intersection Foam Cutoff</strong></em> parameter by the output of the <em><strong>Depth Fade</strong></em> subgraph that we used in the nodes for the depth-based mask. the reason is that we want the foam to be fully formed near the edges of the object, but disintegrate as it goes further away from the shore.</p>
<p><picture><source type="image/webp" srcset="intersection-foam.png-400w.webp 400w, intersection-foam.png-800w.webp 800w, intersection-foam.png-1200w.webp 1200w, intersection-foam.png-2058w.webp 2058w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="intersection-foam.png-400w.jpeg 400w, intersection-foam.png-800w.jpeg 800w, intersection-foam.png-1200w.jpeg 1200w, intersection-foam.png-2058w.jpeg 2058w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="intersection-foam.png-400w.jpeg" width="2058" height="490"></picture></p>
<p>The other nodes are used to set the color of the intersection foam. We multiply the alpha (transparency) of the intersection foam by the output of the nodes of the intersection foam mask that we created before. This makes sure that the intersection foam only shows up where we want it to.</p>
<p>An intersection foam texture could for example look like this.</p>
<p><picture><source type="image/webp" srcset="intersection-foam-texture.png-270w.webp 270w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:50%;" loading="lazy" decoding="async" src="intersection-foam-texture.png-270w.jpeg" width="270" height="270"></picture></p>
<h4>Adding the intersection foam</h4>
<p>Just like for the surface foam, we use the <em><strong>Overlay</strong></em> subgraph we created to nicely blend the intersection foam with the rest of the colors.</p>
<p><picture><source type="image/webp" srcset="intersection-foam-blend.png-400w.webp 400w, intersection-foam-blend.png-800w.webp 800w, intersection-foam-blend.png-1200w.webp 1200w, intersection-foam-blend.png-1416w.webp 1416w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="intersection-foam-blend.png-400w.jpeg 400w, intersection-foam-blend.png-800w.jpeg 800w, intersection-foam-blend.png-1200w.jpeg 1200w, intersection-foam-blend.png-1416w.jpeg 1416w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:50%;" loading="lazy" decoding="async" src="intersection-foam-blend.png-400w.jpeg" width="1416" height="326"></picture></p>
<p>Now we have intersection foam as well as surface foam!</p>
<p>// TODO: Show video</p>
<h2 id="6.-lighting" tabindex="-1"><a class="anchor-link" href="#6.-lighting" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 6. Lighting</h2>
<p>An important feature of the water shader is how lighting interacts with it. We will go for a stylized look.</p>
<h3 id="surface-normals" tabindex="-1"><a class="anchor-link" href="#surface-normals" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Surface normals</h3>
<p>First, we will generate surface normals for the water by sampling a <em><strong>Normals Texture</strong></em>. We will use a common trick which is to sample the texture twicde using slightly different parameters. We then combine the 2 sampled textures by using the <em><strong>Normal Blend</strong></em> node.</p>
<p><picture><source type="image/webp" srcset="surface-normals.png-400w.webp 400w, surface-normals.png-800w.webp 800w, surface-normals.png-1200w.webp 1200w, surface-normals.png-2038w.webp 2038w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="surface-normals.png-400w.jpeg 400w, surface-normals.png-800w.jpeg 800w, surface-normals.png-1200w.jpeg 1200w, surface-normals.png-2038w.jpeg 2038w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="surface-normals.png-400w.jpeg" width="2038" height="1312"></picture></p>
<p>Notice that we only use a single value for the <em><strong>Normals Scale</strong></em> and <em><strong>Normals Speed</strong></em>. We just slightly modify them before sampling the <em><strong>Normals Texture</strong></em> for a second time. Again, we use the <em><strong>Panning UV</strong></em> subgraph we created earlier.</p>
<h3 id="lighting-calculations" tabindex="-1"><a class="anchor-link" href="#lighting-calculations" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Lighting calculations</h3>
<p>Next, we will use the normals to generate the lighting and add it to the water. Again, we will use a <em><strong>Custom Function</strong></em> node. Our custom function node takes in a normal vector, position in world space and view direction in world space. The node then outputs a <em><strong>Diffuse</strong></em> and <em><strong>Specular</strong></em> term. We then perform a <em><strong>Step</strong></em> operation on the terms based on a parameter and introduce a color.</p>
<p><picture><source type="image/webp" srcset="lighting-calculation.png-400w.webp 400w, lighting-calculation.png-800w.webp 800w, lighting-calculation.png-1200w.webp 1200w, lighting-calculation.png-1960w.webp 1960w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="lighting-calculation.png-400w.jpeg 400w, lighting-calculation.png-800w.jpeg 800w, lighting-calculation.png-1200w.jpeg 1200w, lighting-calculation.png-1960w.jpeg 1960w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="lighting-calculation.png-400w.jpeg" width="1960" height="860"></picture></p>
<p>The code for the custom function node looks like this.</p>
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">float</span> <span class="token function">LightingSpecular</span><span class="token punctuation">(</span><span class="token keyword">float3</span> L<span class="token punctuation">,</span> <span class="token keyword">float3</span> N<span class="token punctuation">,</span> <span class="token keyword">float3</span> V<span class="token punctuation">,</span> <span class="token keyword">float</span> smoothness<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">float3</span> H <span class="token operator">=</span> <span class="token function">SafeNormalize</span><span class="token punctuation">(</span><span class="token keyword">float3</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">float3</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">float</span> NdotH <span class="token operator">=</span> <span class="token function">saturate</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> H<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token function">pow</span><span class="token punctuation">(</span>NdotH<span class="token punctuation">,</span> smoothness<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">float</span> <span class="token function">LightingLambert</span><span class="token punctuation">(</span><span class="token keyword">float3</span> L<span class="token punctuation">,</span> <span class="token keyword">float3</span> N<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">saturate</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">MainLighting_float</span><span class="token punctuation">(</span><span class="token keyword">float3</span> normalWS<span class="token punctuation">,</span> <span class="token keyword">float3</span> positionWS<span class="token punctuation">,</span> <span class="token keyword">float3</span> viewWS<span class="token punctuation">,</span> <span class="token keyword">float</span> smoothness<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">float</span> specular<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">float</span> diffuse<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    specular <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span><br>    diffuse <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span><br>    <br>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SHADERGRAPH_PREVIEW</span></span><br>    smoothness <span class="token operator">=</span> <span class="token function">exp2</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> smoothness <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <br>    normalWS <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>normalWS<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    viewWS <span class="token operator">=</span> <span class="token function">SafeNormalize</span><span class="token punctuation">(</span>viewWS<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    Light mainLight <span class="token operator">=</span> <span class="token function">GetMainLight</span><span class="token punctuation">(</span><span class="token function">TransformWorldToShadowCoord</span><span class="token punctuation">(</span>positionWS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    diffuse <span class="token operator">=</span> <span class="token function">LightingLambert</span><span class="token punctuation">(</span>mainLight<span class="token punctuation">.</span>direction<span class="token punctuation">,</span> normalWS<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">//float diffuse_hard = smoothstep(0.005,0.01,diffuse_soft);</span><br>    <span class="token comment">//float diffuse_term = lerp(diffuse_soft, diffuse_hard, hardness);</span><br><br>    specular <span class="token operator">=</span> <span class="token function">LightingSpecular</span><span class="token punctuation">(</span>mainLight<span class="token punctuation">.</span>direction<span class="token punctuation">,</span> normalWS<span class="token punctuation">,</span> viewWS<span class="token punctuation">,</span> smoothness<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">//float specular_hard = smoothstep(0.005,0.01,specular_soft);</span><br>    <span class="token comment">//float specular_term = lerp(specular_soft, specular_hard, hardness);</span><br><br>    <span class="token comment">//specular = specular_term * specular_color;</span><br>    <span class="token comment">//diffuse = diffuse_term * diffuse_color;</span><br>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><br><span class="token punctuation">}</span></code></pre>
<p>We can simply and quite literally <em><strong>Add</strong></em> the lighting to the current output of the graph.</p>
<p><picture><source type="image/webp" srcset="add-lighting.png-400w.webp 400w, add-lighting.png-644w.webp 644w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="add-lighting.png-400w.jpeg 400w, add-lighting.png-644w.jpeg 644w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="add-lighting.png-400w.jpeg" width="644" height="312"></picture></p>
<p>The lighting looks as follows on our water.</p>
<p>// TODO: Add video of lighting effects.</p>
<details>
<summary>Bonus tip: Using surface normals to influence refraction</summary>
<div>
<p>Instead of using gradient noise to generate the refraction like we did before, it might be a better idea to use the surface normals to influence the strength of the refraction. This looks better visually. For this, you will have to transform the generated normals from <em><strong>Tangent</strong></em> space to <em><strong>View</strong></em> space, then <em><strong>Multiply</strong></em> by a <em><strong>Refraction Strength</strong></em> and add the result to the <em><strong>Screen Position</strong></em> to generate the refracted UVs.</p>
</div>
</details>
<h2 id="7.-waves" tabindex="-1"><a class="anchor-link" href="#7.-waves" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 7. Waves</h2>
<p>A big part of the look of our water shader is now complete so let's add some movement.</p>
<h3 id="vertex-displacement" tabindex="-1"><a class="anchor-link" href="#vertex-displacement" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Vertex displacement</h3>
<p>We will be adding wave movement by displacing the vertices of the water plane in the vertex shader. For this to work nicely, you need to make sure that your water plane has a high enough vertex density.</p>
<p>The nodes below show a very basic example of vertex displacement. We take the original world position of the vertex and add an offset (0,0,0) in this case. We then convert from world space to object space and link it up with the vertex position slot.</p>
<p><picture><source type="image/webp" srcset="vertex-displacement.png-400w.webp 400w, vertex-displacement.png-800w.webp 800w, vertex-displacement.png-1200w.webp 1200w, vertex-displacement.png-1776w.webp 1776w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="vertex-displacement.png-400w.jpeg 400w, vertex-displacement.png-800w.jpeg 800w, vertex-displacement.png-1200w.jpeg 1200w, vertex-displacement.png-1776w.jpeg 1776w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="vertex-displacement.png-400w.jpeg" width="1776" height="538"></picture></p>
<h3 id="gerstner-waves" tabindex="-1"><a class="anchor-link" href="#gerstner-waves" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Gerstner waves</h3>
<p>There are many levels of simulating wave displacement. You could start by adding simple sine waves or go all in and create a <a href="https://www.keithlantz.net/2011/11/ocean-simulation-part-two-using-the-fast-fourier-transform/" target="_blank" rel="noopener noreferrer">FFT wave simulation</a>. We will use something inbetween in terms of graphical fidelity: Gerstner Waves. There are many good tutorials about Gerstner Waves. I will just explain how I use them in my shader. If you want more information, I recommend <a href="https://catlikecoding.com/unity/tutorials/flow/waves/" target="_blank" rel="noopener noreferrer">this tutorial about waves by Catlike Coding</a>.</p>
<p>Because the code for the waves is math-heave, we use a custom function node and add the output as an offset to the world position.</p>
<p><picture><source type="image/webp" srcset="gerstner-waves.png-400w.webp 400w, gerstner-waves.png-800w.webp 800w, gerstner-waves.png-1200w.webp 1200w, gerstner-waves.png-1566w.webp 1566w" sizes="(min-width: 30em) 50vw, 100vw"><source type="image/jpeg" srcset="gerstner-waves.png-400w.jpeg 400w, gerstner-waves.png-800w.jpeg 800w, gerstner-waves.png-1200w.jpeg 1200w, gerstner-waves.png-1566w.jpeg 1566w" sizes="(min-width: 30em) 50vw, 100vw"><img class="note-image" alt="Stylized water reflections." style="width:100%;" loading="lazy" decoding="async" src="gerstner-waves.png-400w.jpeg" width="1566" height="548"></picture></p>
<p>The code to generate 4 waves and add them together looks like this.</p>
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">float3</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span><span class="token keyword">float3</span> position<span class="token punctuation">,</span> <span class="token keyword">float</span> steepness<span class="token punctuation">,</span> <span class="token keyword">float</span> wavelength<span class="token punctuation">,</span> <span class="token keyword">float</span> speed<span class="token punctuation">,</span> <span class="token keyword">float</span> direction<span class="token punctuation">,</span> <span class="token keyword">inout</span> <span class="token keyword">float3</span> tangent<span class="token punctuation">,</span> <span class="token keyword">inout</span> <span class="token keyword">float3</span> binormal<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    direction <span class="token operator">=</span> direction <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token keyword">float2</span> d <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token keyword">float2</span><span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token number">3.14</span> <span class="token operator">*</span> direction<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">3.14</span> <span class="token operator">*</span> direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">float</span> k <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3.14</span> <span class="token operator">/</span> wavelength<span class="token punctuation">;</span>                                           <br>    <span class="token keyword">float</span> f <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> position<span class="token punctuation">.</span>xz<span class="token punctuation">)</span> <span class="token operator">-</span> speed <span class="token operator">*</span> _Time<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">float</span> a <span class="token operator">=</span> steepness <span class="token operator">/</span> k<span class="token punctuation">;</span><br><br>    tangent <span class="token operator">+=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><br>    <span class="token operator">-</span>d<span class="token punctuation">.</span>x <span class="token operator">*</span> d<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token punctuation">(</span>steepness <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    d<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token punctuation">(</span>steepness <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token operator">-</span>d<span class="token punctuation">.</span>x <span class="token operator">*</span> d<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>steepness <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    binormal <span class="token operator">+=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><br>    <span class="token operator">-</span>d<span class="token punctuation">.</span>x <span class="token operator">*</span> d<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>steepness <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    d<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>steepness <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token operator">-</span>d<span class="token punctuation">.</span>y <span class="token operator">*</span> d<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>steepness <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><br>    d<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    a <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    d<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">GerstnerWaves_float</span><span class="token punctuation">(</span><span class="token keyword">float3</span> position<span class="token punctuation">,</span> <span class="token keyword">float</span> steepness<span class="token punctuation">,</span> <span class="token keyword">float</span> wavelength<span class="token punctuation">,</span> <span class="token keyword">float</span> speed<span class="token punctuation">,</span> <span class="token keyword">float4</span> directions<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">float3</span> Offset<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">float3</span> normal<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    Offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token keyword">float3</span> tangent <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">float3</span> binormal <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    Offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tangent<span class="token punctuation">,</span> binormal<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    Offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tangent<span class="token punctuation">,</span> binormal<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    Offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">.</span>z<span class="token punctuation">,</span> tangent<span class="token punctuation">,</span> binormal<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    Offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">.</span>w<span class="token punctuation">,</span> tangent<span class="token punctuation">,</span> binormal<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>binormal<span class="token punctuation">,</span> tangent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">//TBN = transpose(float3x3(tangent, binormal, normal));</span><br><span class="token punctuation">}</span></code></pre>
<p>The custom function takes in values for the steepnes, wavelength and speed of the waves as well as 4 direction values between [0,1] each which can control each individual wave. The normal vector is calculated as well.</p>
<p>Feel free to add even more waves, but I think 4 waves is already a nice starting point.</p>
<p>// TODO: Show video of waves</p>
<details>
<summary>Bonus tip: Using wave height to drive color</summary>
<div>
<p>An additional thing you can do is use the Y component of the <em><strong>Offset</strong></em> output of the <em><strong>GerstnerWaves</strong></em> custom function node to influence the colors of the water. This way you can give the tops of the waves a slightly different color.</p>
</div>
</details>
<h2 id="8.-buoyancy" tabindex="-1"><a class="anchor-link" href="#8.-buoyancy" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> 8. Buoyancy</h2>
<p>Buoyancy is a big and complicated topic if you want to achieve a realistic simulation. However, I wanted to share how you can go about adding basic buoyancy to your water.</p>
<h3 id="simulating-on-the-cpu" tabindex="-1"><a class="anchor-link" href="#simulating-on-the-cpu" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Simulating on the CPU</h3>
<p>Currently we are simulating the waves on the GPU through our water shader. To create a buoyancy simulation, we will recreate the wave movement on the CPU in a C# script. This way we can use this CPU simulation to create buoyancy effects for floating objects. The setup looks pretty similar to what we already did in our shader. We create a function <mark>GetWaveDisplacement</mark> which takes in a position and some wave parameters, and then returns an offset which is generated by adding 4 waves together. I added the script below.</p>
<details>
<summary>Script: GerstnerWaveDisplacement.cs</summary>
<div>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span><br><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GerstnerWaveDisplacement</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Vector3</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span> position<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> steepness<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> wavelength<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> speed<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> direction<span class="token punctuation">)</span><br>    <span class="token punctuation">{</span><br>        direction <span class="token operator">=</span> direction <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token class-name">Vector2</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span><span class="token function">Cos</span><span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span>PI <span class="token operator">*</span> direction<span class="token punctuation">)</span><span class="token punctuation">,</span> Mathf<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>Mathf<span class="token punctuation">.</span>PI <span class="token operator">*</span> direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>normalized<span class="token punctuation">;</span><br>        <span class="token class-name"><span class="token keyword">float</span></span> k <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> Mathf<span class="token punctuation">.</span>PI <span class="token operator">/</span> wavelength<span class="token punctuation">;</span><br>        <span class="token class-name"><span class="token keyword">float</span></span> a <span class="token operator">=</span> steepness <span class="token operator">/</span> k<span class="token punctuation">;</span><br>        <span class="token class-name"><span class="token keyword">float</span></span> f <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token punctuation">(</span>Vector2<span class="token punctuation">.</span><span class="token function">Dot</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> position<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> speed <span class="token operator">*</span> Time<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x <span class="token operator">*</span> a <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> a <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>y <span class="token operator">*</span> a <span class="token operator">*</span> Mathf<span class="token punctuation">.</span><span class="token function">Cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Vector3</span> <span class="token function">GetWaveDisplacement</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span> position<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> steepness<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> wavelength<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> speed<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> directions<span class="token punctuation">)</span><br>    <span class="token punctuation">{</span><br>        <span class="token class-name">Vector3</span> offset <span class="token operator">=</span> Vector3<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br><br>        offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        offset <span class="token operator">+=</span> <span class="token function">GerstnerWave</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> steepness<span class="token punctuation">,</span> wavelength<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> directions<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token keyword">return</span> offset<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
</div>
</details>
<h3 id="buoyancy-script" tabindex="-1"><a class="anchor-link" href="#buoyancy-script" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Buoyancy script</h3>
<p>Next, we want to use the CPU simulation of the waves we did to actually make an object float on the water surface. For this I will use an approach that works with <mark>buoyancy effectors</mark>. These are points on an object where the wave offset is sampled and an appropriate force is added to the object. An object can have multiple effectors positioned around the surface of the object.</p>
<p>// TODO: Picture of effectors?</p>
<details>
<summary>Script: BuoyantObject.cs</summary>
<div>
</div>
</details>
<details>
<summary>Going the extra mile: Caustics</summary>
<div>
</div>
</details>
<details>
<summary>Going the extra mile: Reflections</summary>
<div>
</div>
</details>
<details>
<summary>Going the extra mile: Foam shadows</summary>
<div>
</div>
</details>
<details>
<summary>Going the extra mile: Water trails</summary>
<div>
</div>
</details>
<details>
<summary>Bonus tip: World space UVs</summary>
<div>
</div>
</details>
<details>
<summary>Bonus tip: Vertex colors</summary>
<div>
</div>
</details>
<details>
<summary>Bonus tip: Fog</summary>
<div>
</div>
</details>
<h2 id="additional-resources" tabindex="-1"><a class="anchor-link" href="#additional-resources" target="_blank" rel="noopener noreferrer">
                  <span class="screen-reader-only">Jump to heading</span>
                  <span aria-hidden="true" class="anchor-symbol">#</span>
                </a> Additional resources</h2>

        <!--<blockquote><p>See any issues or have any comments about this note? Please <a href="/about">let me know about it</a>.</p></blockquote>-->
        <div class="note-date">
            <time>March 2023</time>
        </div>
    </div>
    <footer class="note-footer">
    <ul class="note-tags"><li>
                <a style="--tag-bg: #eafff3; --tag-text: #61b58e;" href="/tags/unity">unity</a>
            </li><li>
                <a style="--tag-bg: #e1f5f6; --tag-text: #0885ff;" href="/tags/graphics">graphics</a>
            </li><li>
                <a style="--tag-bg: #fef9d3; --tag-text: #f4ad44;" href="/tags/gamedev">gamedev</a>
            </li><li>
                <a style="--tag-bg: #f9f0ff; --tag-text: #936bad;" href="/tags/tutorial">tutorial</a>
            </li></ul>

   <!-- <div>
        <a href="https://twitter.com/_kingdox_" rel="noopener" target="_blank" aria-label="Xavier Arpa Twitter.">
            <span class="icon-twitter footer-icon"></span></a>
        <a href="https://www.linkedin.com/in/alexander-ameye-067a0b70/" rel="noopener" target="_blank" aria-label="Xavier Arpa LinkedIn.">
            <span class="icon-linkedin footer-icon"></span></a>
        <a href="https://github.com/_kingdox_" rel="noopener" target="_blank" aria-label="Xavier Arpa GitHub.">
            <span class="icon-github footer-icon"></span></a>
    </div>-->
</footer>
</div>
    </body>
</html>